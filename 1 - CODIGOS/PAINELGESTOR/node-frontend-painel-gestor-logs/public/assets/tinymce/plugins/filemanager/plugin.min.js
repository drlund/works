tinymce.PluginManager.add('filemanager', function(editor) {
    function openmanager() {
        
        editor.focus(true);
        let FMbaseURL = tinymce.settings.filemanagerBaseURL;
        let customRootDir = tinymce.settings.customRootDir;
        let customRootDirURI = "";

        if (customRootDir !== "") {
            customRootDirURI = 'custom_root_dir=' + customRootDir;
        }

        win = editor.windowManager.openUrl({
            title: 'Gerenciador de Arquivos',
            url:  FMbaseURL + '/plugins/filemanager/dialog.php?editor=' + editor.id + '&lang=' + tinymce.settings.language + '&subfolder=&' + customRootDirURI,
            filetype: 'all',
            inline: 1,
            resizable: true,
            maximizable: true
        })
    }

    editor.ui.registry.addButton('filemanager', {
        icon: 'browse',
        tooltip: 'Insert file',
        shortcut: 'Ctrl+E',
        onAction: openmanager
    });

    editor.addShortcut('Ctrl+E', '', openmanager);

    editor.ui.registry.addMenuItem('filemanager', {
        icon: 'browse',
        text: 'Gerenciar Arquivo',
        onAction: openmanager
    });

    editor.filePickerCallback = openmanager;
});